var util = require('cenfo-util');
var bigInt = require('big-integer');

var p = bigInt("999959");
var q = bigInt("999983");

// 1000 d√≠gitos
//var p = bigInt("6000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000869899");
//var q = bigInt("7247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247247");

module.exports = {
  encriptar: function (mensaje) {
    console.log('Encriptando mensaje...\n');
    console.log('Mensaje: \n' + mensaje);

    var e = util.obtener_e(p, q);
    var n = util.obtener_n(p, q);

    var mensajeEncriptado = "";

    if (mensaje.lenght != 0) {
      mensajeEncriptado = mensaje.split('')
        .map(function (value) {
          return bigInt(value.charCodeAt(0));
        })
        .reduce(function (previous, current) {
          var letraEncriptada = current.modPow(e, n);
          return previous + " " + letraEncriptada;
        }, "");
    }
    return mensajeEncriptado.toString().trim();
  },
  desencriptar: function (codificado) {
    console.log('\nDesencriptando mensaje...\n');
    console.log('Mensaje: \n' + codificado);

    var d = util.obtener_d();
    var n = util.obtener_n(p, q);

    // Mensaje listo para desencriptar, se obtiene como un BigInt
    var mensajeDesencriptado = " ";
    console.log(codificado.lenght);
    if (codificado.lenght != 0) {
      var mensajeDesencriptado = codificado.split(' ')
        .map(function (value) {
          return bigInt(value);
        })
        .reduce(function (previous, current) {
          var letraEncriptada = current.modPow(d, n);
          var letraEnPlano = String.fromCharCode(letraEncriptada.toString());
          return previous + letraEnPlano;
        }, "");
    }
    return mensajeDesencriptado.trim();
  }
};




